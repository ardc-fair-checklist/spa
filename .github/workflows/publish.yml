name: publish

# This workflow is triggered manually. It creates a production build off of main branch
# and publishes it to GitHub pages https://ardc-fair-checklist.github.io/ardc-fair-checklist

on:
  workflow_dispatch:

jobs:

  build:
    name: publish
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Create production build and publish it to Github Pages
        shell: bash
        run: |

          echo "set abort on errors"
          set -e

          echo "get the dependencies"
          npm install

          echo "build"
          npm run build

          echo "navigate into the build output directory"
          cd dist

          echo "set some git properties"
          git config --global init.defaultBranch main
          git config --global user.email "ci@no-reply.com"
          git config --global user.name "ci publish workflow"

          echo "commit the new content"
          git init
          git checkout -b main
          git add -A
          git commit -m "deploy"

          echo "deploy to https://<USERNAME>.github.io/<REPO>"
          git push -f https://github.com/ardc-fair-checklist/ardc-fair-checklist.git main:gh-pages
